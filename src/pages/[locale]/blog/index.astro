---
import Layout from '../../../layouts/Layout.astro'
import { getCollection } from 'astro:content'
import { locales } from '../../../config'

export async function getStaticPaths() {
  return locales.map((locale) => ({
    params: {
      locale,
    },
  }))
}

// TODO: Need to still list out if non-english page doesn't exist

const { locale } = Astro.params

const collection = await getCollection('blog')
const filteredCollection = collection
  .filter((entry) => entry.slug.startsWith(locale ?? 'en'))
  .map((entry) => {
    const [locale, slug] = entry.slug.split('/')
    const year = entry.data.date.getFullYear()
    const month = String(entry.data.date.getMonth() + 1).padStart(2, '0')
    const day = String(entry.data.date.getDate() + 1).padStart(2, '0')

    return {
      slug: `${locale}/blog/${year}/${month}/${day}/${slug}`,
    }
  })
---

<Layout title="Blog Posts">
  <h1>Blog Posts</h1>
  <ul>
    {
      filteredCollection.map((entry) => (
        <li>
          <a href={`/${entry.slug}`}>{entry.slug}</a>
        </li>
      ))
    }
  </ul>
</Layout>
