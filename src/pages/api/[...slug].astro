---
import OnThisPage from '@src/components/Layout/OnThisPage.astro'
import Translate from '@src/components/Layout/Translate.astro'
import Layout from '@src/layouts/SidebarLayout.astro'
import Tree from '@src/components/Tree.astro'
import { geti18nCollection } from '@src/utils'
import { convertCollectionToTree } from '@src/utils.js'
import { astroI18n, t, l } from 'astro-i18n'

export async function getStaticPaths() {
  const collection = await geti18nCollection('api', astroI18n.langCode)

  return collection.map((entry) => ({
    params: {
      slug: entry.slug,
    },
    props: {
      entry,
      collection,
    },
  }))
}

const { entry, collection } = Astro.props
const { Content, headings } = await entry.render()
const tree = convertCollectionToTree(collection)
---

<Layout title="">
  <div slot="leading-sidebar">
    <Tree tree={tree} baseUrl={'/api'} />
  </div>
  <div class="prose">
    <Content />
  </div>
  <div slot="trailing-sidebar">
    <ul>
      <li class="list-heading">{t('layout.on-this-page')}</li>
      <OnThisPage headings={headings} />
      <li class="list-base"></li>
      {
        entry.data.i18n_ready && (
          <>
            <li class="list-heading">{t('layout.contribute')}</li>
            <Translate />
          </>
        )
      }
    </ul>
  </div>
</Layout>
