---
import Author from '@src/components/Blog/Author.astro'
import OnThisPage from '@src/components/Layout/OnThisPage.astro'
import Layout from '@src/layouts/SidebarLayout.astro'
import IconTranslate from '~icons/bi/translate'
import { geti18nCollection } from '@src/utils'
import { astroI18n, t } from 'astro-i18n'
import Carousel from '@src/components/Blog/Carousel.astro'
import config from '@src/config'

export async function getStaticPaths() {
  const collection = await geti18nCollection('blog', astroI18n.langCode)

  return collection.map((entry) => ({
    params: {
      slug: entry.slug,
    },
    props: {
      entry,
    },
  }))
}

const { entry } = Astro.props
let { Content, headings } = await entry.render()
---

<Layout title={entry.data.meta_title}>
  <div class="flex flex-col gap-4">
    <h1 class="h1">{entry.data.meta_title}</h1>
    <div class="small-caps">
      {entry.data.date.toLocaleDateString(undefined, { dateStyle: 'long' })}
    </div>
    <Author authors={entry.data.authors} enableLinks={false} />
    {
      entry.data.imageSrc && (
        <img
          src={entry.data.imageSrc}
          alt={t('blog.post-image')}
          class="rounded-lg"
        />
      )
    }
    {entry.data.meta_description && <div>{entry.data.meta_description}</div>}

    <main class="prose">
      <Content />
    </main>
    <div class="py-8">
      <div class="h3 pb-4">{t('blog.recent-blog-posts')}</div>
      <Carousel />
    </div>
  </div>
  <div slot="trailing-sidebar">
    <div>
      <ul>
        <li class="list-heading">{t('layout.on-this-page')}</li>
        <OnThisPage headings={headings} />
        <li class="list-base"></li>
        {
          entry.data.i18n_ready && (
            <>
              <li class="list-heading">{t('Contribute')}</li>
              <li>
                <a class="list-item" href={config.gitHubTranslateUrl}>
                  <IconTranslate />
                  Translate
                </a>
              </li>
            </>
          )
        }
      </ul>
    </div>
  </div>
</Layout>
